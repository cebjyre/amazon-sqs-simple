#!/usr/bin/perl -w

use lib '../lib';
use Amazon::SQS::Simple;
use Data::Dumper;
$Data::Dumper::Indent = 1;
my $AWSAccessKeyId  = $ENV{AWS_ACCESS_KEY}; 
my $SecretKey       = $ENV{AWS_SECRET_KEY};

use strict;

my $sqs = new Amazon::SQS::Simple($AWSAccessKeyId, $SecretKey, 
    _Version => '2006-04-01', 
    _Debug   => *STDERR,
);

my $q = $sqs->CreateQueue('test-grants');

my $g = $q->ListGrants();
print Dumper $g;
print (('-' x 80) . "\n");

my $permission = shift || 'ReceiveMessage';
my $id = '72fd6729f47aed5ccf146d6f39b29388bc4a5c1d03a7471ece8159bd49b7762a'; #Â sw@netcetera.org

$q->AddGrant('sw@netcetera.org', $permission);

$g = $q->ListGrants();
print Dumper $g;
print (('-' x 80) . "\n");

$q->RemoveGrant('sw@netcetera.org', $permission);

$g = $q->ListGrants();
print Dumper $g;
print (('-' x 80) . "\n");

#$q->AddGrant($id, $permission, IdentifierType => 'ID');
#
#$g = $q->ListGrants();
#print Dumper $g;
#print (('-' x 80) . "\n");
#
#$q->RemoveGrant($id, $permission, IdentifierType => 'ID');
#
#$g = $q->ListGrants();
#print Dumper $g;
#print (('-' x 80) . "\n");

